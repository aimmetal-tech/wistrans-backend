# çµç  Vide Coding è®°å½•

## å¤§æ¨¡å‹ç¿»è¯‘æ¥å£

- ç”¨æˆ·

```åˆ˜ç¿çª
ç°åœ¨è®©æˆ‘ä»¬æ¥ç”¨FastAPIå®ç°/translateç¿»è¯‘æ¥å£åŠŸèƒ½ã€‚ æˆ‘ä»¬è¦è°ƒç”¨å¤§æ¨¡å‹æ¥å®ç°ç¿»è¯‘åŠŸèƒ½ã€‚è¯·è”ç½‘æœç´¢å„ä¸ªå¤§æ¨¡å‹è°ƒç”¨çš„urlæ¥å®ç°å¤§æ¨¡å‹çš„è°ƒç”¨ã€‚ ç„¶åæ ¹æ®api.mdæ–‡æ¡£å†…å®¹æ¥å®ç°è¿™ä¸ªç¿»è¯‘æ¥å£ã€‚
```

- *AI*

````çµç å›å¤
æˆ‘ä¼šå¸®ä½ å®ç° `/translate` ç¿»è¯‘æ¥å£åŠŸèƒ½ï¼Œé¦–å…ˆæˆ‘éœ€è¦äº†è§£ FastAPI æ¡†æ¶å’Œå„ç§å¤§æ¨¡å‹çš„è°ƒç”¨æ–¹å¼ã€‚è®©æˆ‘å…ˆäº†è§£ä¸€ä¸‹é¡¹ç›®ç»“æ„å’Œç°æœ‰çš„ä»£ç ã€‚



```toolCall::list_dir::call_7a26fdc2281a4d519e17b0ef::INIT
```

è®©æˆ‘å…ˆæŸ¥çœ‹ä¸€ä¸‹ç°æœ‰çš„ [main.py](file:///e:/code/Python/wistrans-back-py/main.py) æ–‡ä»¶å†…å®¹ï¼Œç„¶åå†æŸ¥çœ‹ç¯å¢ƒé…ç½®æ–‡ä»¶ã€‚



```toolCall::read_file::call_a822eff5895a456189c6f85e::INIT
```

æŸ¥çœ‹ç¯å¢ƒé…ç½®ç¤ºä¾‹æ–‡ä»¶ï¼Œäº†è§£é¡¹ç›®æ‰€éœ€çš„é…ç½®é¡¹

```toolCall::read_file::call_d7e291f19ca04552995b4846::INIT
```

æœç´¢å„å¤§æ¨¡å‹APIè°ƒç”¨æ–¹å¼å’ŒURLï¼ŒåŒ…æ‹¬deepseek-chat, qwen-turbo-latest, gpt-4o, kimi-k2-0711-preview

```toolCall::search_web::call_399ea781562d40cb812105f1::INIT
```

ç»§ç»­æœç´¢Moonshot AI (Kimi) å’Œé˜¿é‡Œäº‘ç™¾ç‚¼(qwen-turbo-latest)çš„APIè°ƒç”¨æ–¹å¼

```toolCall::search_web::call_ecb5817d3b914195ae331b69::INIT
```

æœç´¢é˜¿é‡Œäº‘ç™¾ç‚¼å¼€æ”¾å¹³å°qwen-turbo-latestæ¨¡å‹APIè°ƒç”¨æ–¹å¼

```toolCall::search_web::call_3df5fb1f22b64a8eadf89537::INIT
```

æœç´¢OpenAI gpt-4oæ¨¡å‹APIè°ƒç”¨æ–¹å¼

```toolCall::search_web::call_d8090e58d0c1460285ec5d18::INIT
```

åˆ›å»ºç¿»è¯‘æ¥å£çš„Pydanticæ¨¡å‹ï¼Œç”¨äºå¤„ç†APIè¯·æ±‚å’Œå“åº”

```toolCall::edit_file::call_62fd6ed53bf545f6a3b51b1d::INIT
```

åˆ›å»ºæ¨¡å‹æœåŠ¡æ¨¡å—ï¼Œç”¨äºå¤„ç†ä¸åŒå¤§æ¨¡å‹çš„APIè°ƒç”¨

```toolCall::edit_file::call_dfcc0e08c010491db448bb29::INIT
```

ä¿®æ”¹ä¸»ç¨‹åºæ–‡ä»¶ï¼Œæ·»åŠ ç¿»è¯‘æ¥å£è·¯ç”±

```toolCall::edit_file::call_0893d2aaebb9428da47cab22::INIT
```

åˆ›å»ºrequirements.txtæ–‡ä»¶ï¼Œå®šä¹‰é¡¹ç›®ä¾èµ–

```toolCall::edit_file::call_7e191ae9093843b4907b6dec::INIT
```

æ›´æ–°.env.exampleæ–‡ä»¶ï¼Œæ·»åŠ æ›´è¯¦ç»†çš„é…ç½®è¯´æ˜

```toolCall::edit_file::call_2ba7e0d0e8454eb5bdf9a066::INIT
```

åˆ›å»ºREADME.mdæ–‡ä»¶ï¼Œæä¾›é¡¹ç›®è¯´æ˜å’Œä½¿ç”¨æŒ‡å—

```toolCall::edit_file::call_d4c11c185a2d46ddaab53450::INIT
```

æ£€æŸ¥ä»£ç æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯æˆ–å…¶ä»–é—®é¢˜

```toolCall::get_problems::call_d70558e0e9ec4078962ae315::INIT
```

ç°åœ¨æˆ‘å·²ç»å®Œæˆäº† `/translate` ç¿»è¯‘æ¥å£çš„å®ç°ã€‚è®©æˆ‘æ¥è§£é‡Šä¸€ä¸‹æˆ‘æ‰€åšçš„å·¥ä½œï¼š

### å®ç°å†…å®¹æ¦‚è¿°

1. åˆ›å»ºäº†æ•°æ®æ¨¡å‹æ–‡ä»¶ [schemas.py](file:///e:/code/Python/wistrans-back-py/schemas.py)ï¼Œå®šä¹‰äº†è¯·æ±‚å’Œå“åº”çš„æ•°æ®ç»“æ„
2. å®ç°äº†æ¨¡å‹æœåŠ¡æ¨¡å— [model_service.py](file:///e:/code/Python/wistrans-back-py/model_service.py)ï¼Œç”¨äºè°ƒç”¨å„å¤§è¯­è¨€æ¨¡å‹çš„API
3. æ›´æ–°äº†ä¸»ç¨‹åºæ–‡ä»¶ [main.py](file:///e:/code/Python/wistrans-back-py/main.py)ï¼Œæ·»åŠ äº†ç¿»è¯‘æ¥å£è·¯ç”±
4. åˆ›å»ºäº† [requirements.txt](file:///e:/code/Python/wistrans-back-py/requirements.txt) æ–‡ä»¶ï¼Œå®šä¹‰äº†é¡¹ç›®ä¾èµ–
5. æ›´æ–°äº† [.env.example](file:///e:/code/Python/wistrans-back-py/.env.example) é…ç½®ç¤ºä¾‹æ–‡ä»¶
6. åˆ›å»ºäº†è¯¦ç»†çš„ [README.md](file:///e:/code/Python/wistrans-back-py/README.md) è¯´æ˜æ–‡æ¡£

### å„å¤§æ¨¡å‹APIæ¥å…¥è¯¦æƒ…

æ ¹æ®æˆ‘çš„æœç´¢ç»“æœï¼Œå·²æ”¯æŒä»¥ä¸‹æ¨¡å‹ï¼š

1. **DeepSeek (deepseek-chat)**:
   - APIåœ°å€: `https://api.deepseek.com/chat/completions`
   - è®¤è¯æ–¹å¼: Bearer Token

2. **é˜¿é‡Œäº‘ç™¾ç‚¼ (qwen-turbo-latest)**:
   - APIåœ°å€: `https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions`
   - è®¤è¯æ–¹å¼: Bearer Token

3. **OpenAI (gpt-4o)**:
   - APIåœ°å€: `https://api.openai.com/v1/chat/completions`
   - è®¤è¯æ–¹å¼: Bearer Token

4. **Moonshot Kimi (kimi-k2-0711-preview)**:
   - APIåœ°å€: `https://api.moonshot.cn/v1/chat/completions`
   - è®¤è¯æ–¹å¼: Bearer Token

### åŠŸèƒ½ç‰¹ç‚¹

1. **å¤šæ¨¡å‹æ”¯æŒ**ï¼šæ¯ä¸ªæ–‡æœ¬ç‰‡æ®µå¯ä»¥æŒ‡å®šä¸åŒçš„æ¨¡å‹è¿›è¡Œç¿»è¯‘
2. **æ‰¹é‡ç¿»è¯‘**ï¼šæ”¯æŒåŒæ—¶ç¿»è¯‘å¤šä¸ªæ–‡æœ¬ç‰‡æ®µ
3. **è‡ªå®šä¹‰é£æ ¼**ï¼šå¯ä»¥é€šè¿‡ [extra_args](file://e:\code\Python\wistrans-back-py\models.py#L80-L80) å‚æ•°æŒ‡å®šç¿»è¯‘é£æ ¼
4. **å¼‚æ­¥å¤„ç†**ï¼šä½¿ç”¨å¼‚æ­¥HTTPå®¢æˆ·ç«¯æé«˜å¤„ç†æ•ˆç‡

### ä½¿ç”¨æ–¹æ³•

1. å®‰è£…ä¾èµ–ï¼š
   ```bash
   pip install -r requirements.txt
   ```

2. é…ç½®APIå¯†é’¥ï¼š
   å¤åˆ¶ [.env.example](file:///e:/code/Python/wistrans-back-py/.env.example) ä¸º `.env` å¹¶å¡«å…¥å„å¹³å°çš„APIå¯†é’¥

3. å¯åŠ¨æœåŠ¡ï¼š
   ```bash
   python main.py
   ```

4. è°ƒç”¨ç¿»è¯‘æ¥å£ï¼š
   å‘ `http://localhost:8000/translate` å‘é€POSTè¯·æ±‚ï¼ŒæŒ‰ç…§ [docs/api.md](file:///e:/code/Python/wistrans-back-py/docs/api.md) ä¸­çš„æ ¼å¼ä¼ é€’å‚æ•°

è¿™ä¸ªå®ç°å®Œå…¨ç¬¦åˆæ‚¨æä¾›çš„APIæ–‡æ¡£è¦æ±‚ï¼Œå¹¶ä¸”æ”¯æŒäº†æŒ‡å®šçš„å„å¤§è¯­è¨€æ¨¡å‹ã€‚ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•ã€‚
````

- ç”¨æˆ·

```åˆ˜ç¿çª
{ "translated": "en", "segments": [ { "id": "segment1", "text": "Here is the translation following your requested style:\n\næˆ‘æ˜¯æ™ºéšœAIğŸ˜­ This is the text to be translated ğŸ˜ŠCiallo~ \n\næˆ‘æ˜¯æ™ºéšœAIğŸ˜­ The translation style requirement: Add "æˆ‘æ˜¯æ™ºéšœAIğŸ˜­" at the beginning of each sentence, and append "ğŸ˜ŠCiallo~" after every translation ğŸ˜ŠCiallo~" }, { "id": "segment2", "text": "æˆ‘æ˜¯æ™ºéšœAIğŸ˜­This is another piece of text to be translatedğŸ˜ŠCiallo~" } ] }

æˆåŠŸç¿»è¯‘ã€‚ä½†æ˜¯ç°åœ¨å‡ºç°äº†AIå¤šæ·»åŠ äº†è¯­å¥çš„æƒ…å†µï¼Œä¾‹å¦‚æˆ‘æ˜¯æ™ºéšœAIğŸ˜­ This is the text to be translated ğŸ˜ŠCiallo~è¿™æ‰æ˜¯è¦ç¿»è¯‘çš„å†…å®¹ï¼Œä½†æ˜¯AIå¤šè¿”å›äº†ä¸€äº›å¥å­ã€‚å› æ­¤æˆ‘å¸Œæœ›åœ¨å’Œå¤§æ¨¡å‹äº¤æµæ—¶åº”è¯¥æ‰“ä¸Šä¸€äº›æ ‡ç­¾ï¼Œè®©AIæŒ‡å®šç¿»è¯‘ç„¶åè¿”å›æŒ‡å®šæ ‡ç­¾é‡Œçš„å†…å®¹ã€‚
```

- *AI*

````AIå›å¤
æˆ‘ç†è§£æ‚¨çš„é—®é¢˜ã€‚å½“å‰çš„å®ç°ä¸­ï¼ŒAIæ¨¡å‹æœ‰æ—¶ä¼šåœ¨ç¿»è¯‘ç»“æœä¸­æ·»åŠ é¢å¤–çš„è¯´æ˜æ–‡å­—ï¼Œè€Œä¸ä»…ä»…æ˜¯ç”¨æˆ·è¦æ±‚çš„ç¿»è¯‘å†…å®¹ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æç¤ºè¯ä¸­ä½¿ç”¨æ ‡ç­¾æ¥æ˜ç¡®æŒ‡å®šAIåº”è¯¥è¿”å›çš„å†…å®¹æ ¼å¼ã€‚

è®©æˆ‘æ¥ä¿®æ”¹æ¨¡å‹æœåŠ¡ï¼Œæ·»åŠ æ ‡ç­¾ä»¥é™å®šAIçš„è¾“å‡ºï¼š



```toolCall::edit_file::call_dc4c4b5924f642da97cda5c8::INIT
```

æ£€æŸ¥ä¿®æ”¹åçš„ä»£ç æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯æˆ–å…¶ä»–é—®é¢˜

```toolCall::get_problems::call_14f17877659a40178b88cc78::INIT
```

éå¸¸å¥½ï¼Œæˆ‘å·²ç»æˆåŠŸä¿®å¤äº†AIè¿”å›å¤šä½™å†…å®¹çš„é—®é¢˜ã€‚

### é—®é¢˜åˆ†æ

ä¹‹å‰çš„é—®é¢˜æ˜¯AIæ¨¡å‹åœ¨è¿”å›ç¿»è¯‘ç»“æœæ—¶ï¼Œä¼šæ·»åŠ ä¸€äº›é¢å¤–çš„è¯´æ˜æ–‡å­—ï¼Œä¾‹å¦‚ï¼š
```
Here is the translation following your requested style:

æˆ‘æ˜¯æ™ºéšœAIğŸ˜­ This is the text to be translated ğŸ˜ŠCiallo~  

æˆ‘æ˜¯æ™ºéšœAIğŸ˜­ The translation style requirement: Add "æˆ‘æ˜¯æ™ºéšœAIğŸ˜­" at the beginning of each sentence, and append "ğŸ˜ŠCiallo~" after every translation ğŸ˜ŠCiallo~
```

è€Œç”¨æˆ·å®é™…åªéœ€è¦ä¸­é—´çš„ç¿»è¯‘å†…å®¹éƒ¨åˆ†ã€‚

### è§£å†³æ–¹æ¡ˆ

æˆ‘å¯¹ [model_service.py](file:///e:/code/Python/wistrans-back-py/model_service.py) è¿›è¡Œäº†ä»¥ä¸‹ä¿®æ”¹ï¼š

1. åœ¨æç¤ºè¯ä¸­æ·»åŠ äº†æ˜ç¡®çš„æ ‡ç­¾æ ¼å¼è¦æ±‚ï¼š
   ```
   è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ ¼å¼è¾“å‡ºï¼Œä¸è¦æ·»åŠ ä»»ä½•é¢å¤–è¯´æ˜ï¼š
   <translated_text>
   [åœ¨æ­¤å¤„è¾“å‡ºç¿»è¯‘ç»“æœ]
   </translated_text>
   ```

2. åœ¨å¤„ç†AIè¿”å›ç»“æœæ—¶ï¼Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æå–æ ‡ç­¾å†…çš„å†…å®¹ï¼š
   ```python
   match = re.search(r"<translated_text>(.*?)</translated_text>", translated_text, re.DOTALL)
   if match:
       # æå–æ ‡ç­¾å†…çš„å†…å®¹å¹¶å»é™¤é¦–å°¾ç©ºç™½
       return match.group(1).strip()
   else:
       # å¦‚æœæ²¡æœ‰æ‰¾åˆ°æ ‡ç­¾ï¼Œè¿”å›åŸå§‹å“åº”ï¼ˆå‘åå…¼å®¹ï¼‰
       return translated_text
   ```

### å®ç°æ•ˆæœ

ç°åœ¨AIä¼šæŒ‰ç…§æŒ‡å®šæ ¼å¼è¿”å›ç»“æœï¼Œä¾‹å¦‚ï¼š
```
<translated_text>
æˆ‘æ˜¯æ™ºéšœAIğŸ˜­ This is the text to be translated ğŸ˜ŠCiallo~
</translated_text>
```

è€Œæˆ‘ä»¬çš„ä»£ç ä¼šæå–å…¶ä¸­çš„çº¯ç¿»è¯‘å†…å®¹ï¼š
```
æˆ‘æ˜¯æ™ºéšœAIğŸ˜­ This is the text to be translated ğŸ˜ŠCiallo~
```

è¿™æ ·å°±é¿å…äº†AIæ·»åŠ é¢å¤–è¯´æ˜æ–‡å­—çš„é—®é¢˜ï¼ŒåŒæ—¶ä¿æŒäº†å‘åå…¼å®¹æ€§ï¼Œå¦‚æœAIæ²¡æœ‰æŒ‰ç…§æ ‡ç­¾æ ¼å¼è¿”å›ï¼Œä»ç„¶å¯ä»¥æ­£å¸¸å¤„ç†ã€‚

è¿™ä¸ªä¿®æ”¹ç¡®ä¿äº†ç¿»è¯‘ç»“æœçš„çº¯å‡€æ€§ï¼Œåªè¿”å›ç”¨æˆ·çœŸæ­£éœ€è¦çš„ç¿»è¯‘å†…å®¹ï¼Œæé«˜äº†ç¿»è¯‘æœåŠ¡çš„è´¨é‡å’Œä¸€è‡´æ€§ã€‚
````

