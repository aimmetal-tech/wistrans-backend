# API æ¥å£æ–‡æ¡£

## åŸºç¡€ä¿¡æ¯

- æœåŠ¡å™¨åœ°å€: `http://localhost:8000`
- æ•°æ®æ ¼å¼: JSON
- å­—ç¬¦ç¼–ç : UTF-8

## æ¥å£åˆ—è¡¨

### 1. å¥åº·æ£€æŸ¥æ¥å£

#### æ¥å£è¯´æ˜

æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€

#### æ¥å£åœ°å€

```
GET /health
```

#### è¯·æ±‚å‚æ•°

æ— 

#### å“åº”ç»“æœ

```json
{
  "status": "ok",
  "message": "æœåŠ¡è¿è¡Œæ­£å¸¸"
}
```

### 2. åˆ›å»ºä¼šè¯æ¥å£

#### æ¥å£è¯´æ˜

åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è¯ä¼šè¯

#### æ¥å£åœ°å€

```
GET /conversations
```

#### è¯·æ±‚å‚æ•°

æ— 

#### å“åº”ç»“æœ

```json
{
  "id": "ä¼šè¯ID"
}
```

### 3. è·å–ä¼šè¯è¯¦æƒ…æ¥å£

#### æ¥å£è¯´æ˜

è·å–æŒ‡å®šä¼šè¯çš„è¯¦ç»†ä¿¡æ¯

#### æ¥å£åœ°å€

```
GET /conversations/detail
```

#### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹   | å¿…å¡« | è¯´æ˜    |
| ------ | ------ | ---- | ------- |
| id     | string | æ˜¯   | ä¼šè¯ ID |

#### å“åº”ç»“æœ

```json
{
  "id": "ä¼šè¯ID",
  "title": "ä¼šè¯æ ‡é¢˜",
  "model": "ä½¿ç”¨çš„æ¨¡å‹",
  "service": "æœåŠ¡å•†",
  "created_at": "åˆ›å»ºæ—¶é—´",
  "updated_at": "æ›´æ–°æ—¶é—´"
}
```

#### å“åº”ç¤ºä¾‹

```json
{
  "id": "a1b2c3d4-e5f6-7890-1234-567890abcdef",
  "title": "äººå·¥æ™ºèƒ½å‘å±•è®¨è®º",
  "model": "deepseek-chat",
  "service": "DeepSeek",
  "created_at": "2024-01-01T10:00:00Z",
  "updated_at": "2024-01-01T10:05:00Z"
}
```

### 4. è·å–ä¼šè¯å†å²è®°å½•æ¥å£

#### æ¥å£è¯´æ˜

è·å–æŒ‡å®šä¼šè¯çš„æ‰€æœ‰å†å²æ¶ˆæ¯è®°å½•

#### æ¥å£åœ°å€

```
GET /conversations/history
```

#### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹   | å¿…å¡« | è¯´æ˜    |
| ------ | ------ | ---- | ------- |
| id     | string | æ˜¯   | ä¼šè¯ ID |

#### å“åº”ç»“æœ

```json
{
  "conversation_id": "ä¼šè¯ID",
  "messages": [
    {
      "id": 1,
      "conversation_id": "ä¼šè¯ID",
      "role": "user",
      "content": "ç”¨æˆ·æ¶ˆæ¯å†…å®¹",
      "created_at": "æ¶ˆæ¯åˆ›å»ºæ—¶é—´"
    },
    {
      "id": 2,
      "conversation_id": "ä¼šè¯ID",
      "role": "assistant",
      "content": "åŠ©æ‰‹å›å¤å†…å®¹",
      "created_at": "æ¶ˆæ¯åˆ›å»ºæ—¶é—´"
    }
  ]
}
```

#### å“åº”ç¤ºä¾‹

```json
{
  "conversation_id": "a1b2c3d4-e5f6-7890-1234-567890abcdef",
  "messages": [
    {
      "id": 1,
      "conversation_id": "a1b2c3d4-e5f6-7890-1234-567890abcdef",
      "role": "user",
      "content": "ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹äººå·¥æ™ºèƒ½çš„å‘å±•å†ç¨‹",
      "created_at": "2024-01-01T10:00:00Z"
    },
    {
      "id": 2,
      "conversation_id": "a1b2c3d4-e5f6-7890-1234-567890abcdef",
      "role": "assistant",
      "content": "äººå·¥æ™ºèƒ½çš„å‘å±•å¯ä»¥åˆ†ä¸ºå‡ ä¸ªé˜¶æ®µ...",
      "created_at": "2024-01-01T10:00:30Z"
    }
  ]
}
```

### 5. æ›´æ–°ä¼šè¯æ¥å£

#### æ¥å£è¯´æ˜

æ›´æ–°ä¼šè¯ä¿¡æ¯ï¼ˆå¦‚æ ‡é¢˜ï¼‰

#### æ¥å£åœ°å€

```
PATCH /conversations/{id}
```

#### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹   | å¿…å¡« | è¯´æ˜    |
| ------ | ------ | ---- | ------- |
| id     | string | æ˜¯   | ä¼šè¯ ID |

#### è¯·æ±‚ä½“

```json
{
  "title": "ä¼šè¯æ ‡é¢˜"
}
```

#### å“åº”ç»“æœ

```json
{
  "message": "ä¼šè¯æ›´æ–°æˆåŠŸ"
}
```

### 6. æµå¼å¯¹è¯æ¥å£

#### æ¥å£è¯´æ˜

ä¸ AI è¿›è¡Œæµå¼å¯¹è¯ï¼Œä½¿ç”¨ Server-Sent Events (SSE) è¿”å›ç»“æœ

#### æ¥å£åœ°å€

```
GET /conversations/stream
```

#### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹   | å¿…å¡« | è¯´æ˜                           |
| ------ | ------ | ---- | ------------------------------ |
| id     | string | æ˜¯   | ä¼šè¯ ID                        |
| input  | string | æ˜¯   | ç”¨æˆ·è¾“å…¥                       |
| model  | string | å¦   | æ¨¡å‹åç§°ï¼Œæ ¼å¼å¦‚ openai/gpt-4o |

#### æ¨¡å‹æŒ‡å®šæ–¹å¼

æ”¯æŒä¸¤ç§æ¨¡å‹æŒ‡å®šæ–¹å¼ï¼š

1. ä½¿ç”¨`æœåŠ¡å•†/æ¨¡å‹`æ ¼å¼ï¼š

   - `qwen/qwen-turbo-latest`
   - `deepseek/deepseek-chat`
   - `openai/gpt-4o`
   - `kimi/kimi-k2-0711-preview`

2. ç›´æ¥æŒ‡å®šæ¨¡å‹åç§°ï¼š
   - `qwen-turbo-latest` (è‡ªåŠ¨è¯†åˆ«ä¸º Qwen)
   - `deepseek-chat` (è‡ªåŠ¨è¯†åˆ«ä¸º DeepSeek)
   - `gpt-4o` (è‡ªåŠ¨è¯†åˆ«ä¸º OpenAI)
   - `kimi-k2-0711-preview` (è‡ªåŠ¨è¯†åˆ«ä¸º Kimi)

#### å“åº”ç»“æœ

æµå¼å¯¹è¯æ¥å£ä½¿ç”¨ Server-Sent Events (SSE) æ ¼å¼è¿”å›æ•°æ®ï¼ŒåŒ…å«ä¸‰ç§äº‹ä»¶ç±»å‹ï¼š

1. **start** äº‹ä»¶ï¼šæµå¼ä¼ è¾“å¼€å§‹æ ‡è®°

```
event: start
data: {}
```

2. **data** äº‹ä»¶ï¼šå®é™…çš„æ¶ˆæ¯å†…å®¹ï¼Œæ ¼å¼éµå¾ª OpenAI çš„æµå¼å“åº”æ ¼å¼

```
event: data
data: {
  "id": "5a69843e-ca50-4127-8228-927ffbddfdf7",
  "object": "chat.completion.chunk",
  "created": 1747828085,
  "model": "deepseek-chat",
  "choices": [
    {
      "index": 0,
      "delta": {
        "content": "è¿™é‡Œæ˜¯æ¶ˆæ¯"
      },
      "logprobs": null,
      "finish_reason": null
    }
  ]
}
```

å…¶ä¸­ `delta` éƒ¨åˆ†åœ¨ä¸åŒé˜¶æ®µå¯èƒ½åŒ…å«ä¸åŒçš„å†…å®¹ï¼š
å½“ç”Ÿæˆç¬¬ä¸€ä¸ªæ¶ˆæ¯æ—¶ï¼Œå¯èƒ½åŒ…å« `role` å­—æ®µï¼Œå¦‚ `{"role": "assistant", "content": ""}`
åœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­ï¼Œä¸»è¦åŒ…å« `content` å­—æ®µï¼Œå¦‚ `{"content": "å…·ä½“çš„å†…å®¹"}`
åœ¨ç»“æŸæ—¶ï¼Œ`delta` ä¸ºç©ºï¼Œä½†ä¼šåŒ…å« `finish_reason` å­—æ®µï¼Œå¦‚ `{"finish_reason": "stop"}`

3. **end** äº‹ä»¶ï¼šæµå¼ä¼ è¾“ç»“æŸæ ‡è®°

```
event: end
data: {}
```

æ•´ä¸ªæµç¨‹æ˜¯ï¼š
å‘é€ `start` äº‹ä»¶è¡¨ç¤ºå¼€å§‹
å‘é€å¤šä¸ª `data` äº‹ä»¶ï¼Œæ¯ä¸ªäº‹ä»¶åŒ…å«å¢é‡å†…å®¹
æœ€åå‘é€ä¸€ä¸ªå¸¦æœ‰ `finish_reason` çš„ `data` äº‹ä»¶
å‘é€ `end` äº‹ä»¶è¡¨ç¤ºç»“æŸ
è¿™ç§æ ¼å¼ä¸ OpenAI å’Œ DeepSeek çš„æµå¼å“åº”æ ¼å¼å…¼å®¹ã€‚

æ”¯æŒçš„æœåŠ¡å•†å’Œé»˜è®¤æ¨¡å‹ï¼š

- Qwen: `qwen-turbo-latest`
- DeepSeek: `deepseek-chat`
- OpenAI: `gpt-4o`
- Kimi: `kimi-k2-0711-preview`

### 7. ç½‘é¡µç¿»è¯‘æ¥å£

#### æ¥å£è¯´æ˜

ä¸“é—¨ç”¨äºç½‘é¡µå†…å®¹ç¿»è¯‘çš„æ¥å£ï¼Œæ”¯æŒæ‰¹é‡ç¿»è¯‘å¤šä¸ªæ–‡æœ¬ç‰‡æ®µ

#### æ¥å£åœ°å€

```
POST /translate
```

#### è¯·æ±‚å‚æ•°

| å‚æ•°å     | ç±»å‹   | å¿…å¡« | è¯´æ˜                             |
| ---------- | ------ | ---- | -------------------------------- |
| target     | string | æ˜¯   | ç›®æ ‡è¯­è¨€ï¼Œå¦‚ "en" è¡¨ç¤ºç¿»è¯‘ä¸ºè‹±è¯­ |
| segments   | array  | æ˜¯   | è¦ç¿»è¯‘çš„æ–‡æœ¬ç‰‡æ®µåˆ—è¡¨             |
| extra_args | string | å¦   | ç¿»è¯‘çš„é¢å¤–è¦æ±‚ï¼Œå¦‚é£æ ¼ç­‰         |

#### segments å‚æ•°è¯´æ˜

| å‚æ•°å | ç±»å‹   | å¿…å¡« | è¯´æ˜                                        |
| ------ | ------ | ---- | ------------------------------------------- |
| id     | string | æ˜¯   | ç‰‡æ®µ IDï¼Œç”¨äºæ ‡è¯†ç‰‡æ®µä»¥ä¾¿è¿”å›åˆ°å‰ç«¯ç›¸åº”ä½ç½® |
| text   | string | æ˜¯   | è¦ç¿»è¯‘çš„æ–‡æœ¬å†…å®¹                            |
| model  | string | å¦   | æ¨¡å‹åç§°ï¼Œé»˜è®¤ä¸º "deepseek-chat"            |

#### è¯·æ±‚ä½“ç¤ºä¾‹

```json
{
  "target": "en",
  "segments": [
    {
      "id": "segment1",
      "text": "è¿™æ˜¯è¦ç¿»è¯‘çš„æ–‡æœ¬"
    },
    {
      "id": "segment2",
      "text": "è¿™æ˜¯å¦ä¸€æ®µè¦ç¿»è¯‘çš„æ–‡æœ¬"
    }
  ],
  "extra_args": "ç¿»è¯‘é£æ ¼è¦æ±‚ï¼Œå¦‚æ­£å¼ã€å£è¯­åŒ–ç­‰"
}
```

#### å“åº”ç»“æœ

```json
{
  "target": "en",
  "segments": [
    {
      "id": "segment1",
      "text": "This is the text to be translated"
    },
    {
      "id": "segment2",
      "text": "This is another text to be translated"
    }
  ],
  "extra_args": {
    "style": "æ¯å¥å¼€å¤´åŠ ä¸Š`ğŸ˜­`ï¼Œåœ¨æ¯å¥ç¿»è¯‘ååŠ ä¸Š`ğŸ˜Š`"
  }
}
```
